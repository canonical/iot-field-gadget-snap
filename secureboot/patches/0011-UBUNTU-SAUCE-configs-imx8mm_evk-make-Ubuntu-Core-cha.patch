From 253e8a733da4c5971e01e9e3269d5efd33c7aab7 Mon Sep 17 00:00:00 2001
From: Ondrej Kubik <ondrej.kubik@canonical.com>
Date: Thu, 15 Apr 2021 13:25:50 +0100
Subject: [PATCH 11/20] UBUNTU: SAUCE: configs: imx8mm_evk: make Ubuntu Core
 changes to the config

Signed-off-by: Ondrej Kubik <ondrej.kubik@canonical.com>
---
 configs/imx8mm_evk_defconfig | 36 +++++++++++++++++++++---------------
 include/configs/imx8mn_evk.h |  4 ++++
 2 files changed, 25 insertions(+), 15 deletions(-)
 mode change 100644 => 100755 configs/imx8mm_evk_defconfig

diff --git a/configs/imx8mm_evk_defconfig b/configs/imx8mm_evk_defconfig
old mode 100644
new mode 100755
index 22ba879f5f0..bb641e33ddc
--- a/configs/imx8mm_evk_defconfig
+++ b/configs/imx8mm_evk_defconfig
@@ -5,8 +5,8 @@ CONFIG_SYS_MALLOC_LEN=0x2000000
 CONFIG_SPL_GPIO=y
 CONFIG_SPL_LIBCOMMON_SUPPORT=y
 CONFIG_SPL_LIBGENERIC_SUPPORT=y
-CONFIG_ENV_SIZE=0x4000
-CONFIG_ENV_OFFSET=0x700000
+CONFIG_ENV_SIZE=0x1000
+# CONFIG_ENV_OFFSET is not set
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x80000000
 CONFIG_SYS_I2C_MXC_I2C1=y
@@ -26,7 +26,7 @@ CONFIG_CSF_SIZE=0x2000
 CONFIG_SYS_LOAD_ADDR=0x40400000
 CONFIG_LTO=y
 CONFIG_DISTRO_DEFAULTS=y
-CONFIG_BOOTCOMMAND="run sr_ir_v2_cmd;run distro_bootcmd;run bsp_bootcmd"
+CONFIG_BOOTCOMMAND="run boot_uc"
 CONFIG_SYS_MONITOR_LEN=524288
 CONFIG_FIT=y
 CONFIG_FIT_EXTERNAL_OFFSET=0x3000
@@ -55,12 +55,12 @@ CONFIG_SYS_MAXARGS=64
 CONFIG_SYS_CBSIZE=2048
 CONFIG_SYS_PBSIZE=2074
 CONFIG_NR_DRAM_BANKS=2
-# CONFIG_CMD_EXPORTENV is not set
-# CONFIG_CMD_IMPORTENV is not set
+CONFIG_CMD_EXPORTENV=y
+CONFIG_CMD_IMPORTENV=y
 CONFIG_CMD_CRC32=y
 CONFIG_CRC32_VERIFY=y
 # CONFIG_BOOTM_NETBSD is not set
-CONFIG_CMD_NVEDIT_EFI=y
+# CONFIG_CMD_ABOOTIMG is not set
 CONFIG_CMD_CLK=y
 CONFIG_CMD_DFU=y
 CONFIG_CMD_FUSE=y
@@ -94,11 +94,13 @@ CONFIG_CMD_FS_GENERIC=y
 CONFIG_CMD_USB=y
 CONFIG_OF_CONTROL=y
 CONFIG_ENV_OVERWRITE=y
+CONFIG_SUPPORT_RAW_INITRD=y
 CONFIG_DEFAULT_FDT_FILE="imx8mm-evk.dtb"
-CONFIG_ENV_IS_IN_MMC=y
+CONFIG_ENV_IS_NOWHERE=y
+# CONFIG_ENV_IS_IN_MMC is not set
 CONFIG_SYS_RELOC_GD_ENV_ADDR=y
-CONFIG_SYS_MMC_ENV_DEV=1
-CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
+CONFIG_SYS_MMC_ENV_DEV=2
+# CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG is not set
 CONFIG_USE_ETHPRIME=y
 CONFIG_ETHPRIME="FEC"
 CONFIG_NET_RANDOM_ETHADDR=y
@@ -112,12 +114,13 @@ CONFIG_MXC_GPIO=y
 CONFIG_FASTBOOT=y
 CONFIG_USB_FUNCTION_FASTBOOT=y
 CONFIG_CMD_FASTBOOT=y
-CONFIG_ANDROID_BOOT_IMAGE=y
+# CONFIG_ANDROID_BOOT_IMAGE is not set
 CONFIG_FASTBOOT_UUU_SUPPORT=y
 CONFIG_FASTBOOT_BUF_ADDR=0x42800000
 CONFIG_FASTBOOT_BUF_SIZE=0x40000000
 CONFIG_FASTBOOT_FLASH=y
 
+CONFIG_NET=y
 CONFIG_DM_I2C=y
 CONFIG_SPL_SYS_I2C_LEGACY=y
 CONFIG_SYS_I2C_MXC=y
@@ -206,8 +209,6 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_CMD_BMP=y
 
 CONFIG_LEGACY_IMAGE_FORMAT=y
-CONFIG_LZO=y
-CONFIG_BZIP2=y
 CONFIG_EFI_SET_TIME=y
 CONFIG_EFI_RUNTIME_UPDATE_CAPSULE=y
 CONFIG_EFI_CAPSULE_ON_DISK=y
@@ -215,15 +216,20 @@ CONFIG_EFI_CAPSULE_FIRMWARE_RAW=y
 CONFIG_EFI_SECURE_BOOT=y
 CONFIG_SPL_RSA=y
 CONFIG_SHA384=y
+CONFIG_LZ4=y
+CONFIG_LZMA=y
+CONFIG_LZO=y
+CONFIG_GZIP=y
+CONFIG_ZLIB_UNCOMPRESS=y
+CONFIG_BZIP2=y
+CONFIG_ZLIB=y
+CONFIG_ZSTD=y
 CONFIG_EFI_VAR_BUF_SIZE=139264
 CONFIG_EFI_IGNORE_OSINDICATIONS=y
 CONFIG_EFI_CAPSULE_AUTHENTICATE=y
 CONFIG_OPTEE=y
 CONFIG_CMD_OPTEE_RPMB=y
-CONFIG_EFI_MM_COMM_TEE=y
 CONFIG_TEE=y
-CONFIG_EFI_ESRT=y
-CONFIG_EFI_HAVE_CAPSULE_UPDATE=y
 CONFIG_FIT_SIGNATURE=y
 CONFIG_DM_RNG=y
 CONFIG_KASLR=y
diff --git a/include/configs/imx8mn_evk.h b/include/configs/imx8mn_evk.h
index 6c5c6406d6f..a282e9eb4e9 100644
--- a/include/configs/imx8mn_evk.h
+++ b/include/configs/imx8mn_evk.h
@@ -16,6 +16,10 @@
 
 #define PHY_ANEG_TIMEOUT 20000
 
+/* Enable auto retry and reset */
+#define CONFIG_RESET_TO_RETRY
+#define CONFIG_BOOT_RETRY_TIME 0
+
 #ifdef CONFIG_DISTRO_DEFAULTS
 #define BOOT_TARGET_DEVICES(func) \
 	func(USB, usb, 0) \
-- 
2.40.1

