From 31561d779ff92ffb3173db259847cea08325fd1e Mon Sep 17 00:00:00 2001
From: Isaac True <isaac.true@canonical.com>
Date: Thu, 23 Nov 2023 12:56:37 +0100
Subject: [PATCH] arm: dts: rockchip: enable OP-TEE support

The binary distributed by Rockchip for the rk3588 is a .bin file,
which cannot be used by the default configuration which expects an ELF
file.

Signed-off-by: Isaac True <isaac.true@canonical.com>
---
 arch/arm/dts/rockchip-u-boot.dtsi | 20 +++++++-------------
 1 file changed, 7 insertions(+), 13 deletions(-)

diff --git a/arch/arm/dts/rockchip-u-boot.dtsi b/arch/arm/dts/rockchip-u-boot.dtsi
index c8c928c7e50..308f9406301 100644
--- a/arch/arm/dts/rockchip-u-boot.dtsi
+++ b/arch/arm/dts/rockchip-u-boot.dtsi
@@ -99,20 +99,14 @@
 					};
 #endif
 				};
-				@tee-SEQ {
-					fit,operation = "split-elf";
-					description = "TEE";
-					type = "tee";
+				op-tee {
+					description = "OP-TEE";
+					type = "firmware";
 					arch = "arm64";
-					os = "tee";
+					os = "op-tee";
 					compression = "none";
-					fit,load;
-					fit,entry;
-					fit,data;
-
-					tee-os {
-						optional;
-					};
+					load = <(CFG_SYS_SDRAM_BASE + 0x8400000)>;
+					entry = <(CFG_SYS_SDRAM_BASE + 0x8400000)>;
 #ifdef CONFIG_SPL_FIT_SIGNATURE
 					hash {
 						algo = "sha256";
@@ -157,7 +151,7 @@
 					description = "NAME.dtb";
 					fdt = "fdt-SEQ";
 #ifdef CONFIG_ARM64
-					fit,firmware = "atf-1", "u-boot";
+					fit,firmware = "atf-1", "op-tee", "u-boot";
 #else
 					fit,firmware = "op-tee", "u-boot";
 #endif
-- 
2.40.1

